commands:
  deploy_app:
    description: "Build the application before tests"
    steps:
      - run: sh publish_pod_ocean_tokens.sh          
      - run: bundle exec fastlane upload_to_diawi
  config_workspace:
    description: "Install or Restore configurations"
    steps:
      - restore_cache:
          key: circlev2-{{ checksum "Gemfile.lock" }}
      - run: 
          name: Install Bundle if not exist in cache
          command: bundle check --path=vendor/bundle || bundle install --path=vendor/bundle --jobs=4 --retry=3
      - save_cache:
          key: circlev2-{{ checksum "Gemfile.lock" }}
          paths: 
            - vendor/bundle
      - restore_cache:
          key: build-temp-pods-{{ checksum "Podfile.lock" }}
      - run:
          name: Install Pods
          command: pod install
      - save_cache:
          key: build-temp-pods-{{ checksum "Podfile.lock" }}
          paths: 
            - Pods/

workflows:
  version: 2.1
  commit:
    jobs:
      - config-workspace
      - deploy:
          filters:
            branches:
              only: master
